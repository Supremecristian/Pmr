<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Totalizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; padding-bottom: 60px; }
    h2 { text-align: center; }
    .form-group { margin-bottom: 10px; }
    label { display: block; font-weight: bold; margin-bottom: 4px; }
    input, select, button { width: 100%; padding: 8px; margin-bottom: 10px; font-size: 16px; }
    button { background: #007bff; color: white; border: none; border-radius: 5px; }
    button:hover { background: #0056b3; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #f2f2f2; }
    .result { font-weight: bold; margin-top: 10px; }
    .actions { display: flex; gap: 10px; }
    .actions button { flex: 1; }
  </style>
</head>
<body>
  <h2>Totalizer Calculator</h2>

  <div class="form-group">
    <label for="date">Date:</label>
    <input type="date" id="date">
  </div>

  <div class="form-group">
    <label for="mode">Mode:</label>
    <select id="mode">
      <option value="liters">Liters</option>
      <option value="peso">Peso</option>
      <option value="meter">Meter</option>
    </select>
  </div>

  <div class="form-group">
    <label for="fuel">Fuel Type:</label>
    <select id="fuel">
      <option value="ado1">ADO 1</option>
      <option value="ado2">ADO 2</option>
      <option value="xtra">Xtra</option>
      <option value="xcs">XCS</option>
    </select>
  </div>

  <div class="form-group">
    <label for="price">Price per Liter:</label>
    <input type="number" id="price" step="0.01">
  </div>

  <div class="form-group">
    <label for="beginning">Beginning:</label>
    <input type="number" id="beginning" step="0.01">
  </div>

  <div class="form-group">
    <label for="ending">Ending:</label>
    <input type="number" id="ending" step="0.01">
  </div>

  <div class="actions">
    <button onclick="calculate()">Calculate</button>
    <button onclick="clearHistory()">Clear History</button>
  </div>

  <div class="result" id="result"></div>

  <h3>History</h3>
  <table id="historyTable">
    <thead>
      <tr>
        <th>Date</th>
        <th>Fuel</th>
        <th>Mode</th>
        <th>Liters</th>
        <th>Amount</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const defaultPrices = { ado1: 57.80, ado2: 57.80, xtra: 54.70, xcs: 55.70 };
    let prices = JSON.parse(localStorage.getItem('prices')) || defaultPrices;
    let savedInputs = JSON.parse(localStorage.getItem('savedInputs')) || {};
    let history = JSON.parse(localStorage.getItem('history')) || [];

    function truncate(num) {
      return Math.floor(num * 100) / 100;
    }

    function saveData() {
      localStorage.setItem('prices', JSON.stringify(prices));
      localStorage.setItem('savedInputs', JSON.stringify(savedInputs));
      localStorage.setItem('history', JSON.stringify(history));
    }

    function loadInputs() {
      const fuel = document.getElementById('fuel').value;
      const mode = document.getElementById('mode').value;

      document.getElementById('price').value = prices[fuel] || '';

      if (savedInputs[fuel] && savedInputs[fuel][mode]) {
        document.getElementById('beginning').value = savedInputs[fuel][mode].beginning || '';
        document.getElementById('ending').value = savedInputs[fuel][mode].ending || '';
      } else {
        document.getElementById('beginning').value = '';
        document.getElementById('ending').value = '';
      }
    }

    function calculate() {
      const date = document.getElementById('date').value || new Date().toISOString().split('T')[0];
      const mode = document.getElementById('mode').value;
      const fuel = document.getElementById('fuel').value;
      let price = parseFloat(document.getElementById('price').value) || 0;
      const beginning = parseFloat(document.getElementById('beginning').value) || 0;
      const ending = parseFloat(document.getElementById('ending').value) || 0;

      // Update prices + sync ado1 and ado2
      if (fuel === 'ado1' || fuel === 'ado2') {
        prices['ado1'] = price;
        prices['ado2'] = price;
      } else {
        prices[fuel] = price;
      }

      let liters = 0, amount = 0;

      if (mode === 'liters' || mode === 'meter') {
        liters = truncate(ending - beginning);
        amount = truncate(liters * price);
      } else if (mode === 'peso') {
        amount = truncate(ending - beginning);
        liters = price > 0 ? truncate(amount / price) : 0;
      }

      // Save inputs separately by mode
      if (!savedInputs[fuel]) savedInputs[fuel] = {};
      savedInputs[fuel][mode] = { beginning, ending };

      // Record history
      history.push({ date, fuel, mode, liters, amount });
      saveData();

      document.getElementById('result').textContent = 
        `Liters: ${liters} | Amount: ₱${amount}`;
      renderHistory();
    }

    function renderHistory() {
      const tbody = document.querySelector('#historyTable tbody');
      tbody.innerHTML = '';
      history.forEach(entry => {
        const row = `<tr>
          <td>${entry.date}</td>
          <td>${entry.fuel.toUpperCase()}</td>
          <td>${entry.mode}</td>
          <td>${entry.liters}</td>
          <td>₱${entry.amount}</td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }

    function clearHistory() {
      if (confirm('Clear all history?')) {
        history = [];
        saveData();
        renderHistory();
      }
    }

    document.getElementById('fuel').addEventListener('change', loadInputs);
    document.getElementById('mode').addEventListener('change', loadInputs);

    window.onload = () => {
      renderHistory();
      loadInputs();
    };
  </script>
</body>
</html>
