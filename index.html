<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Fuel Totalizer — v2</title>
<style>
  :root{
    --bg:#f7f7f8; --card:#ffffff; --text:#222; --muted:#6b7280; --accent:#2563eb;
    --border:#e5e7eb; --good:#059669; --danger:#b91c1c;
  }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  body{margin:0;background:var(--bg);color:var(--text)}
  .wrap{max-width:680px;margin:0 auto;padding:16px}
  h1{font-size:1.4rem;margin:8px 0 14px;text-align:center}
  .card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:0 4px 16px rgba(0,0,0,.05);padding:14px;margin-bottom:16px}
  label{display:block;font-size:.9rem;margin:10px 0 6px}
  select,input[type="number"],input[type="date"]{width:100%;padding:12px 14px;border:1px solid var(--border);border-radius:12px;font-size:1rem}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .result{margin-top:12px;padding:12px;border:1px dashed var(--border);border-radius:12px;background:#fafafa}
  .result strong{color:var(--good)}
  .tools{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .btn{display:inline-block;padding:12px 14px;border:1px solid var(--border);border-radius:12px;background:var(--accent);color:#fff;font-weight:700;text-align:center;cursor:pointer;width:100%}
  .btn.small{padding:8px 10px;font-size:.95rem}
  .btn.secondary{background:#fff;color:var(--text);border:1px solid var(--border);font-weight:700}
  .btn.danger{background:var(--danger);border-color:transparent;color:#fff}
  .hint{font-size:.85rem;color:var(--muted);margin-top:8px}
  table{width:100%;border-collapse:separate;border-spacing:0 6px;margin-top:6px}
  th,td{padding:10px 12px;background:#fff;border:1px solid var(--border)}
  th{background:#f3f4f6;text-align:left;font-size:.9rem;color:var(--muted)}
  @media (min-width:560px){ .tools .btn{width:auto} }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Fuel Totalizer</h1>

    <section class="card">
      <div class="row">
        <div>
          <label for="fuel">Fuel Type</label>
          <select id="fuel">
            <option value="ADO1">Ado 1</option>
            <option value="XTRA">Xtra</option>
            <option value="XCS">XCS</option>
            <option value="ADO2">Ado 2</option>
          </select>
        </div>
        <div>
          <label for="mode">Mode</label>
          <select id="mode">
            <option value="LITERS">Liters</option>
            <option value="PESO">Peso</option>
            <option value="METER">Meter</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="date">Date</label>
          <input type="date" id="date">
        </div>
        <div>
          <label for="price">Price (₱/L)</label>
          <input type="number" id="price" step="0.01" inputmode="decimal" placeholder="e.g. 57.80">
        </div>
      </div>

      <div class="row">
        <div>
          <label for="begin">Beginning</label>
          <input type="number" id="begin" step="0.01" inputmode="decimal" placeholder="Beginning reading">
        </div>
        <div>
          <label for="end">Ending</label>
          <input type="number" id="end" step="0.01" inputmode="decimal" placeholder="Ending reading">
        </div>
      </div>

      <div class="result" id="resultBox">
        <div><strong>Liters:</strong> <span id="litersVal">0.00</span></div>
        <div><strong>Amount (₱):</strong> <span id="amountVal">0.00</span></div>
      </div>

      <div class="tools">
        <button class="btn small" id="calculateBtn">Calculate</button>
        <button class="btn small secondary" id="saveInputs">Save Inputs</button>
        <button class="btn small" id="saveEntry">Save to History</button>
      </div>

      <div class="hint">Press <strong>Calculate</strong> to compute results. Then press <strong>Save to History</strong> to store the row (or Save Inputs to keep price/beg/end for this fuel).</div>
    </section>

    <section class="card">
      <h3 style="margin-top:0">History</h3>
      <div style="display:flex;gap:10px;margin-bottom:10px;flex-wrap:wrap">
        <button class="btn danger small" id="clearHistory">Clear History</button>
      </div>
      <div style="overflow-x:auto">
        <table id="historyTable">
          <thead>
            <tr>
              <th style="min-width:110px">Date</th>
              <th>Fuel</th>
              <th style="min-width:90px">Liters</th>
              <th style="min-width:110px">Amount (₱)</th>
            </tr>
          </thead>
          <tbody id="historyBody"></tbody>
        </table>
      </div>
    </section>
  </div>

<script>
  const DEFAULT_PRICES = { ADO1:57.80, XTRA:54.70, XCS:55.70, ADO2:57.80 };
  const FUEL_LABELS = { ADO1:'Ado 1', XTRA:'Xtra', XCS:'XCS', ADO2:'Ado 2' };

  const LS = {
    get(k, d){ try{ const v = localStorage.getItem(k); return v ? JSON.parse(v) : d; }catch{ return d; } },
    set(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} }
  };

  const fuelSel = document.getElementById('fuel');
  const modeSel = document.getElementById('mode');
  const dateInp = document.getElementById('date');
  const priceInp = document.getElementById('price');
  const beginInp = document.getElementById('begin');
  const endInp = document.getElementById('end');
  const litersVal = document.getElementById('litersVal');
  const amountVal = document.getElementById('amountVal');
  const historyBody = document.getElementById('historyBody');
  const calculateBtn = document.getElementById('calculateBtn');
  const saveInputsBtn = document.getElementById('saveInputs');
  const saveEntryBtn = document.getElementById('saveEntry');
  const clearHistoryBtn = document.getElementById('clearHistory');

  // signature to ensure user pressed Calculate for current inputs
  let lastCalcSignature = null;

  function todayYMD(){ const d=new Date(); const m=String(d.getMonth()+1).padStart(2,'0'); const day=String(d.getDate()).padStart(2,'0'); return `${d.getFullYear()}-${m}-${day}`; }
  dateInp.value = todayYMD();

  function loadFuelState(fuel){
    const prices = LS.get('prices', DEFAULT_PRICES);
    const inputs = LS.get('inputs', {});
    priceInp.value = (prices[fuel] !== undefined ? prices[fuel] : DEFAULT_PRICES[fuel]).toFixed(2);
    const f = inputs[fuel] || { begin:'', end:'' };
    beginInp.value = f.begin;
    endInp.value = f.end;
    // clear displayed results until user presses Calculate
    litersVal.textContent = '0.00';
    amountVal.textContent = '0.00';
    lastCalcSignature = null;
  }

  function savePriceForFuel(fuel, price){
    const prices = LS.get('prices', DEFAULT_PRICES);
    prices[fuel] = price;
    LS.set('prices', prices);
  }

  function saveInputsForFuel(fuel, begin, end){
    const inputs = LS.get('inputs', {});
    inputs[fuel] = { begin, end };
    LS.set('inputs', inputs);
  }

  function recalc(){
    const fuel = fuelSel.value;
    const mode = modeSel.value;
    const price = parseFloat(priceInp.value) || 0;
    const b = parseFloat(beginInp.value) || 0;
    const e = parseFloat(endInp.value) || 0;

    let liters = 0, amount = 0;

    if(mode === 'PESO'){
      amount = e - b;
      liters = price ? (amount / price) : 0;
    } else {
      liters = e - b;
      amount = liters * price;
    }

    // Function to truncate a number to a specified number of decimal places
    const truncate = (num, digits) => {
        const factor = Math.pow(10, digits);
        return Math.floor(num * factor) / factor;
    };

    litersVal.textContent = truncate(liters, 2).toFixed(2);
    amountVal.textContent = truncate(amount, 2).toFixed(2);

    lastCalcSignature = JSON.stringify({ fuel, mode, price: Number(price).toFixed(2), begin: Number(b).toFixed(2), end: Number(e).toFixed(2), date: dateInp.value });
}
 

  function renderHistory(){
    const hist = LS.get('history', []);
    historyBody.innerHTML = '';
    hist.forEach(row => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${row.date}</td>
        <td>${FUEL_LABELS[row.fuel] || row.fuel}</td>
        <td>${Number(row.liters).toFixed(2)}</td>
        <td>${Number(row.amount).toFixed(2)}</td>
      `;
      historyBody.appendChild(tr);
    });
  }

  function addHistoryEntry(entry){
    const hist = LS.get('history', []);
    hist.push(entry);
    LS.set('history', hist);
    renderHistory();
  }

  // events
  fuelSel.addEventListener('change', ()=> loadFuelState(fuelSel.value));
  modeSel.addEventListener('change', ()=> { /* no auto-calc */ });

  calculateBtn.addEventListener('click', ()=>{
    recalc();
  });

  saveInputsBtn.addEventListener('click', ()=>{
    const fuel = fuelSel.value;
    const price = parseFloat(priceInp.value) || 0;
    const b = beginInp.value;
    const e = endInp.value;
    savePriceForFuel(fuel, price);
    saveInputsForFuel(fuel, b, e);
    alert('Saved price, beginning, and ending for ' + FUEL_LABELS[fuel]);
  });

  saveEntryBtn.addEventListener('click', ()=>{
    const currentSig = JSON.stringify({ fuel: fuelSel.value, mode: modeSel.value, price: Number((parseFloat(priceInp.value)||0)).toFixed(2), begin: Number(parseFloat(beginInp.value)||0).toFixed(2), end: Number(parseFloat(endInp.value)||0).toFixed(2), date: dateInp.value });
    if(!lastCalcSignature || lastCalcSignature !== currentSig){
      alert('Please press Calculate first to compute results for the current inputs.');
      return;
    }
    const entry = {
      date: dateInp.value || todayYMD(),
      fuel: fuelSel.value,
      liters: parseFloat(litersVal.textContent) || 0,
      amount: parseFloat(amountVal.textContent) || 0
    };
    addHistoryEntry(entry);
    alert('Saved to history.');
  });

  clearHistoryBtn.addEventListener('click', ()=>{
    if(confirm('Clear all saved history?')){
      LS.set('history', []);
      renderHistory();
    }
  });

  // initial
  loadFuelState(fuelSel.value);
  renderHistory();
</script>
</body>
</html>
