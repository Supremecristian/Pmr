<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fuel Totalizer</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f9fafb;
    margin: 0;
    padding: 1rem;
    color: #111;
  }
  h1 {
    text-align: center;
    margin-bottom: 1rem;
    color: #2563eb;
  }
  .card {
    background: #fff;
    padding: 1rem;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    max-width: 480px;
    margin: 0 auto 1.5rem;
  }
  label {
    display: block;
    margin-top: 0.75rem;
    font-size: 0.9rem;
    font-weight: 600;
  }
  select, input {
    width: 100%;
    padding: 0.7rem;
    margin-top: 0.3rem;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    font-size: 1rem;
  }
  button {
    margin-top: 1rem;
    width: 100%;
    padding: 0.9rem;
    background: #2563eb;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: bold;
    cursor: pointer;
  }
  button:hover {
    background: #1e40af;
  }
  .result {
    margin-top: 1rem;
    padding: 0.8rem;
    background: #f1f5f9;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: bold;
    text-align: center;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1rem;
    font-size: 0.9rem;
  }
  th, td {
    padding: 0.6rem;
    border-bottom: 1px solid #e5e7eb;
    text-align: center;
  }
  th {
    background: #f3f4f6;
    color: #374151;
  }
</style>
</head>
<body>
  <h1>Fuel Totalizer</h1>

  <div class="card">
    <label for="mode">Mode</label>
    <select id="mode">
      <option value="liters">Liters</option>
      <option value="pesos">Pesos</option>
      <option value="meter">Mechanical</option>
    </select>

    <label for="fuel">Fuel Type</label>
    <select id="fuel">
      <option value="ado1">ADO 1</option>
      <option value="xtra">Xtra</option>
      <option value="xcs">XCS</option>
      <option value="ado2">ADO 2</option>
    </select>

    <label for="price">Price (₱)</label>
    <input type="number" id="price" step="0.01" />

    <label for="begin">Beginning</label>
    <input type="number" id="begin" step="0.01" />

    <label for="end">Ending</label>
    <input type="number" id="end" step="0.01" />

    <button onclick="calculate()">Calculate</button>
    <div class="result" id="result">Result will appear here</div>
  </div>

  <div class="card">
    <h2 style="text-align:center; margin-top:0;">History</h2>
    <table id="history">
      <thead>
        <tr>
          <th>Fuel</th>
          <th>Mode</th>
          <th>Liters</th>
          <th>Amount (₱)</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
const DEC = 2;
const FACT = 10 ** DEC;

function parseFixed(str) {
  const s = String(str ?? "").trim();
  if (!s) return 0;
  const neg = s.startsWith("-");
  const [i, f = ""] = s.replace("-", "").split(".");
  const frac = (f + "0".repeat(DEC)).slice(0, DEC);
  const n = (parseInt(i || "0", 10) * FACT) + parseInt(frac || "0", 10);
  return neg ? -n : n;
}

function toNumberFromInt(intVal) {
  return intVal / FACT;
}

function loadData() {
  return JSON.parse(localStorage.getItem("fuelData") || '{"prices":{},"inputs":{},"history":[]}');
}

function saveData(data) {
  localStorage.setItem("fuelData", JSON.stringify(data));
}

function loadUI() {
  const data = loadData();
  const fuel = document.getElementById("fuel").value;
  const mode = document.getElementById("mode").value;

  if (data.prices[fuel] !== undefined) {
    document.getElementById("price").value = data.prices[fuel];
  }

  if (data.inputs[fuel] && data.inputs[fuel][mode]) {
    document.getElementById("begin").value = data.inputs[fuel][mode].begin;
    document.getElementById("end").value = data.inputs[fuel][mode].end;
  }

  const tbody = document.querySelector("#history tbody");
  tbody.innerHTML = "";
  data.history.slice().reverse().forEach(row => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${row.fuel}</td><td>${row.mode}</td>
                    <td>${row.liters.toFixed(2)}</td>
                    <td>${row.amount.toFixed(2)}</td>`;
    tbody.appendChild(tr);
  });
}

function calculate() {
  const mode = document.getElementById("mode").value;
  const fuel = document.getElementById("fuel").value;
  const priceStr = document.getElementById("price").value;
  const beginStr = document.getElementById("begin").value;
  const endStr = document.getElementById("end").value;

  if (priceStr === "" || beginStr === "" || endStr === "") {
    alert("Please fill all fields");
    return;
  }

  const beginInt = parseFixed(beginStr);
  const endInt   = parseFixed(endStr);
  const priceInt = parseFixed(priceStr);

  let litersInt = 0;
  let amountInt = 0;

  if (mode === "liters" || mode === "meter") {
    litersInt = endInt - beginInt;
    amountInt = Math.floor((litersInt * priceInt + 50) / 100);
  } else {
    amountInt = endInt - beginInt;
    if (priceInt === 0) { alert("Price cannot be zero"); return; }
    litersInt = Math.floor((amountInt * 100 + Math.floor(priceInt/2)) / priceInt);
  }

  const liters = toNumberFromInt(litersInt);
  const amount = toNumberFromInt(amountInt);

  document.getElementById("result").innerText =
    `Liters: ${liters.toFixed(2)} | Amount: ₱${amount.toFixed(2)}`;

  const data = loadData();

  const priceNum = Number(priceStr);
  if (fuel === "ado1" || fuel === "ado2") {
    data.prices.ado1 = priceNum;
    data.prices.ado2 = priceNum;
  } else {
    data.prices[fuel] = priceNum;
  }

  if (!data.inputs[fuel]) data.inputs[fuel] = {};
  data.inputs[fuel][mode] = { begin: beginStr, end: endStr };

  data.history.push({ fuel, mode, liters, amount });
  saveData(data);
  loadUI();
}

document.getElementById("fuel").addEventListener("change", loadUI);
document.getElementById("mode").addEventListener("change", loadUI);

loadUI();
</script>
</body>
</html>
